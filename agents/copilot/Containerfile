# GitHub Copilot CLI Toolbox
ARG BASE_IMAGE=ghcr.io/oliveagle/toolbox-opencode/toolbox-base:latest
FROM ${BASE_IMAGE}

LABEL agent="copilot"
LABEL description="GitHub Copilot CLI toolbox"

# 安装 GitHub CLI 和 Copilot 扩展
RUN curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg && \
    chmod go+r /usr/share/keyrings/githubcli-archive-keyring.gpg && \
    echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | tee /etc/apt/sources.list.d/github-cli.list > /dev/null && \
    apt-get update && \
    apt-get install -y gh && \
    rm -rf /var/lib/apt/lists/*

# 安装 Copilot CLI
RUN gh extension install github/copilot 2>/dev/null || \
    echo "Copilot CLI 需要手动安装: gh extension install github/copilot"

RUN mkdir -p /home/toolboxuser/.config/gh && \
    chown -R toolboxuser:toolboxuser /home/toolboxuser/.config

ENV AGENT_NAME=copilot
ENV AGENT_CMD="gh copilot"

CMD ["/bin/bash"]
