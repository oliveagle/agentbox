# OpenCode + Claude Code Combined Toolbox
ARG BASE_IMAGE=localhost/toolbox-base:latest
FROM ${BASE_IMAGE}

LABEL agent="occ"
LABEL description="OpenCode + Claude Code combined toolbox"

# Install OpenCode
RUN npm install -g opencode-ai

# Install Claude Code
RUN curl -fsSL https://claude.ai/install | bash || \
    npm install -g @anthropic-ai/claude-code 2>/dev/null || \
    echo "Claude Code requires manual install: npm install -g @anthropic-ai/claude-code"

# Create config directories
RUN mkdir -p /home/oliveagle/.config/opencode && \
    mkdir -p /home/oliveagle/.config/claude && \
    chown -R oliveagle:oliveagle /home/oliveagle/.config

# Install common tools for both agents
RUN apt-get update && apt-get install -y \
    gh \
    hub \
    && rm -rf /var/lib/apt/lists/*

# Default to Claude Code (more popular)
ENV AGENT_NAME=occ
ENV AGENT_CMD=claude

# Don't override CMD - let base image's sleep infinity run
# This ensures the entrypoint completes initialization
